При первом запросе http://localhost/imagehandler.ashx?fileid=159&width=200 файл помещается в дисковый кеш
с именем 4C45BB2CC5C830C0D3378F3D42F92A73B638B849.tmp

При последующих запросах по тому же url, возвращается готовый файл .tmp

Одному исходному файлу соответствует множество файлов .tmp, созданных в разное время

Если дата/время последней модификации файла в кеше меньше даты/времени последней модификации исходного файла,
то значит кеш устарел и соответствующий файл .tmp требует обновления

Исходное изображение может не иметь файла-источника (внешние адреса, штрих-коды, картинки в БД и др.)
В этом случае нужно обеспечить автоматическое обновление кеша.

Добавление cdv=18 в адрес ресурса автоматически позволит обновлять кеш на стороне клиента. Обработка этого параметра, 
насколько я понимаю, не требуется в хандлере, но его желательно добавлять в клиентские модули и др. код.

*** Можно сохранять метку времени удаления из кеша в имени файла: HASH_TIME.tmp. 
В этом случае, если текущее время на сервере больше этой метки, файл в кеше нужно удалить,
создать новый с новым именем. Проверка файла на существование несколько усложнена
(Directory.GetFiles вместо File.Exists). Таким образом, можно избавиться от необходимости трудоемкой
очистки и обновления всего кеша.

Если отметка времени в имени файла кеша отсутствует или равна fffff..., то файл кеша не устаревает. 
В этом случае нужно использовать проверку даты/времени последней модификации, как описано выше.


 

